<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gr치fico de Dist칙ncias 1.1</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
    }
    h1 {
      font-size: 1.5em;
    }
    .data {
      margin: 10px 0;
      font-size: 1.2em;
    }
    canvas {
      max-width: 100%;
      height: 100% !important;
    }
    .chart-container {
      max-width: 100%;
      height: 250px;
    }
  </style>
</head>
<body>
  <h1>Leituras do Sensor</h1>
  <div class="data">Dist칙ncia atual: <span id="valor">---</span> cm</div>

  <div class="chart-container">
    <canvas id="grafico"></canvas>
  </div>

  <script>
    const url = "https://mdfsensor-44da4-default-rtdb.firebaseio.com/leituras.json"; // Substitua SEU_USUARIO
    let ctx = document.getElementById('grafico').getContext('2d');

    let data = {
      labels: [],
      datasets: [{
        label: 'Dist칙ncia (cm)',
        data: [],
        borderColor: 'blue',
        backgroundColor: 'rgba(0,0,255,0.1)',
        fill: true,
        tension: 0.2
      }]
    };

    let chart = new Chart(ctx, {
      type: 'line',
      data: data,
      options: {
        responsive: true,
        maintainAspectRatio: true,
        aspectRatio: 2,
        animation: false,
        scales: {
          x: { display: false },
          y: {
            beginAtZero: false,
            suggestedMin: 0,
            suggestedMax: 100
          }
        },
        plugins: {
          zoom: {
            pan: {
              enabled: true,
              mode: 'xy'
            },
            zoom: {
              wheel: {
                enabled: true
              },
              pinch: {
                enabled: true
              },
              mode: 'xy'
            }
          }
        }
      }
    });

    async function atualizar() {
      try {
        const response = await fetch(url + "?t=" + new Date().getTime());
        const json = await response.json();

        document.getElementById("valor").textContent = json.distancia;

        if (data.labels.length >= 300) {
          data.labels.shift();
          data.datasets[0].data.shift();
        }

        data.labels.push("");
        data.datasets[0].data.push(json.distancia);

        let max = Math.max(...data.datasets[0].data);
        let min = Math.min(...data.datasets[0].data);

        chart.options.scales.y.min = Math.floor((min - 0.5) * 10) / 10;
        chart.options.scales.y.max = Math.ceil((max + 0.5) * 10) / 10;

        chart.update();
      } catch (e) {
        console.error("Erro ao obter dados:", e);
      }
    }

    setInterval(atualizar, 1000);
  </script>
</body>
</html>
